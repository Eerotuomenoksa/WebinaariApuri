
<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeniorSurf Verkkol√§hetyslaskuri</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; overflow: hidden; }
        .settings-scroll::-webkit-scrollbar { width: 6px; }
        .settings-scroll::-webkit-scrollbar-track { background: transparent; }
        .settings-scroll::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .7; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "htm": "https://esm.sh/htm@3.1.1"
      }
    }
    </script>

    <script type="module">
        import React, { useState, useEffect } from 'react';
        import ReactDOM from 'react-dom';
        import htm from 'htm';

        const html = htm.bind(React.createElement);

        const MusicType = {
            NONE: 'Ei musiikkia',
            CUSTOM: 'Oma musiikkitiedosto',
            AIRY: 'Ilmava ja kevyt',
            WARM: 'L√§mmin ja pehme√§',
            CALM: 'Tyyni ja syv√§'
        };

        class AudioService {
            constructor() {
                this.audioCtx = null;
                this.voices = [];
                this.mainGain = null;
                this.currentType = MusicType.NONE;
                this.volume = 0.2;
                this.isMuted = false;
                this.audioEl = null;
            }

            init() {
                if (!this.audioCtx) {
                    this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    this.mainGain = this.audioCtx.createGain();
                    this.mainGain.connect(this.audioCtx.destination);
                    this.mainGain.gain.setValueAtTime(this.isMuted ? 0 : this.volume, this.audioCtx.currentTime);
                }
            }

            setMuted(muted) {
                this.isMuted = muted;
                if (this.mainGain && this.audioCtx) {
                    const targetGain = this.isMuted ? 0 : this.volume;
                    this.mainGain.gain.setTargetAtTime(targetGain, this.audioCtx.currentTime, 0.2);
                }
                if (this.audioEl) {
                    this.audioEl.volume = this.isMuted ? 0 : this.volume;
                }
            }

            createRichVoice(freq, type = 'sine') {
                if (!this.audioCtx || !this.mainGain) return;
                const osc = this.audioCtx.createOscillator();
                const voiceGain = this.audioCtx.createGain();
                const filter = this.audioCtx.createBiquadFilter();

                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.audioCtx.currentTime);
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(1000, this.audioCtx.currentTime);
                voiceGain.gain.setValueAtTime(0, this.audioCtx.currentTime);
                
                osc.connect(filter);
                filter.connect(voiceGain);
                voiceGain.connect(this.mainGain);

                const now = this.audioCtx.currentTime;
                voiceGain.gain.setTargetAtTime(0.1, now, 2);
                osc.start();
                this.voices.push({ osc, gain: voiceGain });
            }

            play(type, customUrl) {
                this.init();
                if (this.currentType === type && type !== MusicType.CUSTOM) return;
                this.stop();
                this.currentType = type;

                if (type === MusicType.NONE || !this.audioCtx) return;
                if (this.audioCtx.state === 'suspended') this.audioCtx.resume();

                if (type === MusicType.CUSTOM && customUrl) {
                    this.audioEl = new Audio(customUrl);
                    this.audioEl.loop = true;
                    this.audioEl.volume = this.isMuted ? 0 : this.volume;
                    this.audioEl.play().catch(console.error);
                    return;
                }

                switch (type) {
                    case MusicType.AIRY: [174.61, 220.00, 261.63, 329.63, 349.23].forEach(f => this.createRichVoice(f, 'sine')); break;
                    case MusicType.WARM: [130.81, 196.00, 261.63, 293.66, 392.00].forEach(f => this.createRichVoice(f, 'triangle')); break;
                    case MusicType.CALM: [116.54, 174.61, 233.08, 277.18].forEach(f => this.createRichVoice(f, 'sine')); break;
                }
            }

            stop() {
                if (this.audioEl) { this.audioEl.pause(); this.audioEl = null; }
                if (this.voices.length > 0 && this.mainGain && this.audioCtx) {
                    const now = this.audioCtx.currentTime;
                    this.voices.forEach(v => {
                        v.gain.gain.setTargetAtTime(0, now, 0.5);
                        setTimeout(() => { try { v.osc.stop(); } catch (e) {} }, 1000);
                    });
                    this.voices = [];
                }
                this.currentType = MusicType.NONE;
            }
        }

        const audioService = new AudioService();

        const SettingsModal = ({ settings, setSettings, onClose }) => {
            const handleFileChange = (e, key) => {
                const file = e.target.files?.[0];
                if (file) {
                    const url = URL.createObjectURL(file);
                    setSettings({ ...settings, [key]: url });
                }
            };

            return html`
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col overflow-hidden animate-in fade-in zoom-in duration-300">
                        <div className="p-6 border-b flex justify-between items-center">
                            <h2 className="text-xl font-semibold text-slate-800">Asetukset</h2>
                            <button onClick=${onClose} className="text-slate-400 hover:text-slate-600 transition-colors">
                                <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>

                        <div className="p-6 overflow-y-auto settings-scroll flex-1 space-y-6">
                            <div className="p-4 bg-purple-50 rounded-xl border border-purple-100 space-y-3">
                                <div className="flex items-center justify-between">
                                    <label className="text-sm font-bold text-purple-900 uppercase">Tapahtuman tila</label>
                                    <div className="flex items-center gap-2">
                                        <button 
                                            onClick=${() => setSettings({...settings, isBreakMode: !settings.isBreakMode})}
                                            className="w-12 h-6 rounded-full relative transition-colors duration-300 ${settings.isBreakMode ? 'bg-purple-600' : 'bg-slate-300'}"
                                        >
                                            <div className="absolute top-1 w-4 h-4 bg-white rounded-full transition-all duration-300 ${settings.isBreakMode ? 'left-7' : 'left-1'}" />
                                        </button>
                                        <span className="text-xs font-bold ${settings.isBreakMode ? 'text-purple-600' : 'text-slate-400'}">Tauko p√§√§ll√§</span>
                                    </div>
                                </div>
                                ${settings.isBreakMode && html`
                                    <input type="text" placeholder="Taukoteksti..." className="w-full px-3 py-1.5 bg-white border border-purple-200 rounded-lg outline-none text-sm" 
                                        value=${settings.breakText} 
                                        onChange=${e => setSettings({...settings, breakText: e.target.value})} />
                                `}
                            </div>

                            <div className="space-y-4">
                                <div className="space-y-2">
                                    <label className="text-sm font-medium text-slate-600">Otsikko</label>
                                    <input className="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg outline-none" 
                                        value=${settings.eventTitle} 
                                        onChange=${e => setSettings({...settings, eventTitle: e.target.value})} />
                                </div>
                                <div className="space-y-2">
                                    <label className="text-xs font-semibold text-slate-500 uppercase">Otsikon paikka</label>
                                    <div className="grid grid-cols-3 gap-2">
                                        ${['above', 'overlay', 'below'].map(pos => html`
                                            <button key=${pos} onClick=${() => setSettings({...settings, titlePosition: pos})}
                                                className="px-3 py-2 text-xs font-bold rounded-lg border transition-all ${settings.titlePosition === pos ? 'bg-slate-800 text-white border-slate-800' : 'bg-white text-slate-600 border-slate-200'}">
                                                ${pos === 'above' ? 'Yll√§' : pos === 'below' ? 'Alla' : 'Kuvassa'}
                                            </button>
                                        `)}
                                    </div>
                                </div>
                            </div>

                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="text-xs font-semibold text-slate-500 uppercase">Alkamisaika</label>
                                    <input type="datetime-local" className="w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg outline-none text-sm" 
                                        value=${settings.startTime} 
                                        onChange=${e => setSettings({...settings, startTime: e.target.value})} />
                                </div>
                                <div>
                                    <label className="text-xs font-semibold text-slate-500 uppercase">Taustav√§ri</label>
                                    <input type="color" className="w-full h-10 p-1 bg-slate-50 border border-slate-200 rounded-lg cursor-pointer" 
                                        value=${settings.backgroundColor} 
                                        onChange=${e => setSettings({...settings, backgroundColor: e.target.value})} />
                                </div>
                            </div>

                            <div className="p-4 bg-blue-50 rounded-xl border border-blue-100 space-y-4">
                                <label className="text-sm font-bold text-blue-900 uppercase">Viestit osallistujille</label>
                                <div className="space-y-3">
                                    <label className="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" checked=${settings.showCameraWarning} onChange=${e => setSettings({...settings, showCameraWarning: e.target.checked})} className="w-4 h-4 text-blue-600 rounded" />
                                        <span className="text-sm text-slate-700 font-medium">Kamerakielto (viesti infopalstalla)</span>
                                    </label>
                                    <label className="flex items-center gap-2 cursor-pointer">
                                        <input type="checkbox" checked=${settings.showMicWarning} onChange=${e => setSettings({...settings, showMicWarning: e.target.checked})} className="w-4 h-4 text-blue-600 rounded" />
                                        <span className="text-sm text-slate-700 font-medium">Mikrofonikielto (viesti infopalstalla)</span>
                                    </label>
                                    <label className="flex items-center gap-2 cursor-pointer pt-2 border-t border-blue-200">
                                        <input type="checkbox" checked=${settings.showSeconds} onChange=${e => setSettings({...settings, showSeconds: e.target.checked})} className="w-4 h-4 text-blue-600 rounded" />
                                        <span className="text-sm text-slate-700 font-medium">N√§yt√§ sekunnit kellossa</span>
                                    </label>
                                </div>
                            </div>

                            <div className="space-y-3 p-4 bg-slate-50 rounded-xl border border-slate-100">
                                <label className="text-sm font-bold text-slate-700 uppercase tracking-wider">Taustamusiikki</label>
                                <select className="w-full px-4 py-2 bg-white border border-slate-200 rounded-lg" 
                                    value=${settings.musicType} 
                                    onChange=${e => setSettings({...settings, musicType: e.target.value})}>
                                    ${Object.values(MusicType).map(t => html`<option key=${t} value=${t}>${t}</option>`)}
                                </select>
                                ${settings.musicType === MusicType.CUSTOM && html`
                                    <input type="file" accept="audio/*" onChange=${e => handleFileChange(e, 'customMusicUrl')} className="text-xs mt-2" />
                                `}
                            </div>

                            <div className="space-y-4">
                                <div>
                                    <label className="text-xs font-semibold text-slate-500 uppercase">Lataa Logo</label>
                                    <input type="file" accept="image/*" onChange=${e => handleFileChange(e, 'logoUrl')} className="text-sm w-full" />
                                </div>
                                <div>
                                    <label className="text-xs font-semibold text-slate-500 uppercase">Lataa Taustakuva</label>
                                    <input type="file" accept="image/*" onChange=${e => handleFileChange(e, 'imageUrl')} className="text-sm w-full" />
                                </div>
                                <div>
                                    <label className="text-xs font-semibold text-slate-500 uppercase">Lis√§tiedot / Tervehdys</label>
                                    <textarea className="w-full px-4 py-2 bg-white border border-slate-200 rounded-lg h-20 resize-none text-sm" 
                                        value=${settings.extraInfo} 
                                        onChange=${e => setSettings({...settings, extraInfo: e.target.value})} />
                                </div>
                            </div>
                        </div>

                        <div className="p-6 border-t bg-slate-50 flex justify-end">
                            <button onClick=${onClose} className="px-8 py-3 bg-slate-900 text-white rounded-xl font-bold hover:bg-slate-800 transition-colors">VALMIS</button>
                        </div>
                    </div>
                </div>
            `;
        };

        const App = () => {
            const [settings, setSettings] = useState({
                eventTitle: 'Verkkol√§hetyksen Otsikko',
                startTime: new Date(Date.now() + 3600000).toISOString().slice(0, 16),
                backgroundColor: '#f1f5f9',
                showSeconds: true,
                extraInfo: 'Tervetuloa mukaan! Aloitamme hetken kuluttua.',
                musicType: MusicType.NONE,
                customMusicUrl: null,
                logoUrl: null,
                imageUrl: 'https://images.unsplash.com/photo-1475721027785-f74eccf877e2?auto=format&fit=crop&q=80&w=1200',
                showCameraWarning: true,
                showMicWarning: true,
                titlePosition: 'overlay',
                isBreakMode: false,
                breakText: 'Olemme pienell√§ tauolla. Palaamme pian!',
                countdownStyle: 'digital',
            });

            const [timeLeft, setTimeLeft] = useState({ days: 0, hours: 0, minutes: 0, seconds: 0 });
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [isMuted, setIsMuted] = useState(false);

            useEffect(() => {
                const timer = setInterval(() => {
                    const target = new Date(settings.startTime).getTime();
                    const now = new Date().getTime();
                    const diff = Math.max(0, target - now);
                    setTimeLeft({
                        days: Math.floor(diff / (1000 * 60 * 60 * 24)),
                        hours: Math.floor((diff / (1000 * 60 * 60)) % 24),
                        minutes: Math.floor((diff / 1000 / 60) % 60),
                        seconds: Math.floor((diff / 1000) % 60)
                    });
                }, 1000);
                return () => clearInterval(timer);
            }, [settings.startTime]);

            useEffect(() => {
                audioService.play(settings.musicType, settings.customMusicUrl);
            }, [settings.musicType, settings.customMusicUrl]);

            useEffect(() => {
                audioService.setMuted(isMuted);
            }, [isMuted]);

            const Title = ({ isOverlay }) => html`
                <h1 className="font-bold tracking-tight leading-tight ${isOverlay ? "text-3xl md:text-5xl text-white drop-shadow-2xl" : "text-3xl md:text-5xl text-slate-900"}">
                    ${settings.eventTitle}
                </h1>
            `;

            return html`
                <div className="h-screen w-screen flex flex-col relative transition-colors duration-700" style=${{ backgroundColor: settings.backgroundColor }}>
                    
                    <div className="absolute top-8 left-8 z-20">
                        ${settings.logoUrl ? html`<img src=${settings.logoUrl} className="h-20 md:h-28 object-contain" />` : html`<div className="h-20 w-20 md:h-28 md:w-28 bg-white/50 rounded-2xl flex items-center justify-center text-slate-400 text-[10px] font-bold uppercase border border-dashed">Logo</div>`}
                    </div>

                    <main className="flex-1 flex flex-col items-center justify-center px-8 lg:px-20 py-10">
                        <div className="w-full max-w-7xl grid grid-cols-1 lg:grid-cols-12 gap-12 items-center">
                            
                            <div className="lg:col-span-7 flex flex-col items-center lg:items-start space-y-6">
                                ${settings.titlePosition === 'above' && html`<div className="mb-2"><${Title} isOverlay=${false} /></div>`}
                                
                                <div className="w-full aspect-video bg-white rounded-[2.5rem] overflow-hidden shadow-2xl relative border-8 border-white/50">
                                    <img src=${settings.imageUrl} className="w-full h-full object-cover" />
                                    
                                    ${settings.titlePosition === 'overlay' && html`
                                        <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent flex items-end pb-12 px-10">
                                            <${Title} isOverlay=${true} />
                                        </div>
                                    `}

                                    ${settings.isBreakMode && html`
                                        <div className="absolute inset-0 bg-purple-900/60 backdrop-blur-md flex items-center justify-center z-20">
                                            <div className="bg-white px-10 py-6 rounded-3xl shadow-2xl border-b-8 border-purple-700 transform -rotate-3">
                                                <span className="text-3xl md:text-5xl font-black text-purple-700 uppercase tracking-tighter italic">Pieni tauko</span>
                                            </div>
                                        </div>
                                    `}
                                </div>

                                ${settings.titlePosition === 'below' && html`<div className="mt-2"><${Title} isOverlay=${false} /></div>`}
                            </div>

                            <div className="lg:col-span-5 flex flex-col space-y-6">
                                <div className="bg-white/40 backdrop-blur-2xl rounded-[3rem] p-10 border border-white/60 shadow-2xl space-y-6">
                                    <p className="text-xs text-slate-500 font-bold uppercase tracking-[0.2em]">${settings.isBreakMode ? 'Ilmoitus' : 'Tapahtuma alkaa'}</p>
                                    
                                    ${settings.isBreakMode ? html`<p className="text-3xl font-bold text-slate-800 leading-tight">${settings.breakText}</p>` : html`
                                        <div className="flex gap-4">
                                            ${[
                                                {v: timeLeft.days, l: 'Pv', s: timeLeft.days > 0},
                                                {v: timeLeft.hours, l: 'H', s: true},
                                                {v: timeLeft.minutes, l: 'Min', s: true},
                                                {v: timeLeft.seconds, l: 'Sek', s: settings.showSeconds}
                                            ].filter(u => u.s).map(u => html`
                                                <div key=${u.l} className="flex flex-col items-center bg-white/80 rounded-3xl p-4 min-w-[80px] border border-white">
                                                    <span className="text-3xl md:text-5xl font-black text-slate-900 tabular-nums">${String(u.v).padStart(2, '0')}</span>
                                                    <span className="text-[10px] text-slate-400 font-black uppercase mt-1 tracking-widest">${u.l}</span>
                                                </div>
                                            `)}
                                        </div>
                                    `}
                                </div>

                                <div className="flex flex-col gap-3">
                                    ${settings.showCameraWarning && html`
                                        <div className="bg-red-50/80 backdrop-blur-sm text-red-700 px-5 py-4 rounded-2xl flex items-center gap-4 text-xs md:text-sm font-bold shadow-sm border border-red-200 animate-in slide-in-from-right duration-500">
                                            <span className="text-xl">üì∑</span>
                                            <span>Toivomme ett√§ l√§hetyksen aikana kamerasi on suljettu</span>
                                        </div>
                                    `}
                                    ${settings.showMicWarning && html`
                                        <div className="bg-slate-800/90 backdrop-blur-sm text-white px-5 py-4 rounded-2xl flex items-center gap-4 text-xs md:text-sm font-bold shadow-sm border border-slate-700 animate-in slide-in-from-right duration-700">
                                            <span className="text-xl">üé§</span>
                                            <span>Toivomme ett√§ l√§hetyksen aikana mikrofonisi on suljettu</span>
                                        </div>
                                    `}
                                </div>

                                ${settings.extraInfo && !settings.isBreakMode && html`
                                    <div className="bg-white/20 p-6 rounded-3xl border border-white/30 backdrop-blur-sm shadow-sm">
                                        <div className="italic text-slate-700 text-xl font-medium leading-relaxed">"${settings.extraInfo}"</div>
                                    </div>
                                `}
                            </div>
                        </div>
                    </main>

                    <footer className="h-24 bg-white/20 backdrop-blur-xl flex items-center justify-center relative border-t border-white/40">
                        <div className="text-center">
                            <p className="text-slate-500 text-xs font-bold uppercase tracking-widest opacity-70">SeniorSurf.fi</p>
                            <p className="text-slate-400 text-[10px] mt-1 italic">Vanhusty√∂n keskusliitto</p>
                        </div>
                        <div className="absolute right-12 flex gap-4">
                            <button onClick=${() => setIsMuted(!isMuted)} className="w-12 h-12 flex items-center justify-center bg-white rounded-2xl shadow-lg border border-slate-100 hover:scale-110 transition-transform">
                                ${isMuted ? 'üîá' : 'üîä'}
                            </button>
                            <button onClick=${() => setIsSettingsOpen(true)} className="w-12 h-12 flex items-center justify-center bg-white rounded-2xl shadow-lg border border-slate-100 hover:scale-110 transition-transform">
                                ‚öôÔ∏è
                            </button>
                        </div>
                    </footer>

                    ${isSettingsOpen && html`<${SettingsModal} settings=${settings} setSettings=${setSettings} onClose=${() => setIsSettingsOpen(false)} />`}
                </div>
            `;
        };

        ReactDOM.createRoot(document.getElementById('root')).render(html`<${App} />`);
    </script>
</body>
</html>
